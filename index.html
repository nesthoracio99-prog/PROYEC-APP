<!doctype html>
<html lang="es">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0b0f14">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CCTV â€” Visor 3D Pro (v15-stable)</title>
  <style>
    html, body { margin:0; height:100%; overflow:hidden; background:#0b0f14; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    
    /* HUD Principal */
    #hud {
      position:fixed; left:12px; top:12px; z-index:10;
      color:#e7eefc; background: rgba(10, 15, 20, 0.85);
      padding:12px 16px; border-radius:12px; width: 340px;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      max-height: 90vh; overflow-y: auto;
    }

    h3 { margin: 0 0 10px 0; font-size: 16px; display:flex; justify-content:space-between; align-items:center; }
    .status-dot { width:8px; height:8px; background:#4caf50; border-radius:50%; display:inline-block; margin-right:6px; box-shadow:0 0 8px #4caf50; }
    
    /* Controles y Botones */
    .section {
      margin-bottom: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(255,255,255,0.03);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    .section:last-child { margin-bottom: 0; }
    .section-title{
      display:block;
      font-weight: 600;
      letter-spacing: 0.04em;
      font-size: 11px;
      color: #c9d4ea;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    
    .row { display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
    
    button {
      flex: 1; cursor:pointer; border:1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05); color:#ccc;
      padding:6px 10px; border-radius:6px; font-size: 12px; transition: all 0.2s;
    }
    button:hover { background: rgba(255,255,255,0.15); color: #fff; }
    button.active { background: rgba(60, 100, 255, 0.3); border-color: rgba(100, 150, 255, 0.6); color: #fff; box-shadow: 0 0 8px rgba(60, 100, 255, 0.2); }
    button.danger { color: #ff8888; border-color: rgba(255, 100, 100, 0.2); }
    button.success { color: #88ffaa; border-color: rgba(100, 255, 150, 0.2); }

    /* Inputs de rango */
    label { display: flex; justify-content: space-between; font-size: 11px; color: #aaa; margin-top: 6px; }
    input[type=range] { width: 100%; margin: 4px 0 8px 0; accent-color: #4a90e2; cursor: pointer; }
    .val-disp { color: #fff; font-weight: bold; }

    /* TextArea y otros */
    textarea {
      width: 100%; height: 80px; resize: vertical;
      background: rgba(0,0,0,0.5); color:#fff;
      border:1px solid rgba(255,255,255,0.1); border-radius:6px;
      font-family: monospace; font-size: 11px; margin-top:8px; display:none;
    }
    .pill { font-size:10px; padding:2px 6px; border-radius:4px; background:rgba(255,255,255,0.1); margin-left: auto; }

    /* Notificaciones */
    #err {
      position:fixed; left:50%; bottom:20px; transform: translateX(-50%); z-index:20;
      font: 13px system-ui; color:#fff; background: rgba(20,20,20,0.9);
      border:1px solid #444; padding:10px 20px; border-radius:20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.6); display:none; text-align: center;
    }
    .success-msg { border-color: #2e7d32 !important; background: rgba(10, 30, 10, 0.95) !important; color: #a5d6a7 !important; }
      button:disabled, input:disabled { opacity: 0.45; cursor: not-allowed; }

  
    /* Extras (Plan / Capas) */
    .small { font-size: 11px; color: #aaa; margin-top: 6px; line-height: 1.25; }
    select {
      width: 100%; box-sizing: border-box;
      padding: 7px 8px; border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08);
      color: #e7eefc; margin-top: 6px;
      outline: none;
    }
    option { background:#0b0f14; color:#e7eefc; }
    button.off { opacity: 0.55; filter: saturate(0.7); }

    input[type=text]{
      width:100%; box-sizing:border-box;
      padding:7px 8px; border-radius:10px;
      border:1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06);
      color:#e7eefc; font-size:12px;
      margin-top:6px; outline:none;
    }
    input[type=text]::placeholder{ color: rgba(231,238,252,0.45); }
    select{
      width:100%; box-sizing:border-box;
      padding:6px 8px; border-radius:8px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      color:#e7eefc; font-size:12px;
      margin-top:6px; outline:none;
    }
    input[type=color]{
      width:100%; height:34px; padding:0;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.35);
      margin-top:6px;
    }

    /* --- Mobile / Responsive --- */
    .iconbtn{ flex:0 !important; padding:4px 8px !important; border-radius:10px !important; }
    #hud.collapsed{ width:auto; max-height:none; overflow:hidden; }
    #hud.collapsed .section{ display:none; }
    #hud::-webkit-scrollbar{ width: 8px; }
    #hud::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,0.2);
      border-radius: 999px;
    }
    #hud::-webkit-scrollbar-track{ background: rgba(0,0,0,0.2); }
    @media (max-width: 900px){
      #hud{ width: calc(100vw - 16px); left:8px; top:8px; padding:12px 12px; border-radius:14px; max-height: 72vh; }
      button{ font-size:13px; padding:10px 12px; border-radius:12px; }
      label{ font-size:12px; }
      .pill{ font-size:11px; }
      input[type=text]{ padding:10px 10px; border-radius:12px; font-size:13px; }
      select{ padding:10px 10px; border-radius:12px; font-size:13px; }
    }


    /* --- UI Mode (FÃ¡cil/Pro) --- */
    .ui-easy .pro-only{ display:none !important; }
    .ui-pro  .easy-only{ display:none !important; }

    /* Wizard / pasos */
    #easyWizard .steps{ display:grid; grid-template-columns:1fr; gap:6px; margin-top:8px; }
    .step{
      display:flex; align-items:center; justify-content:space-between;
      font-size:12px; padding:8px 10px; border-radius:10px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
      color:#cfd8ea;
    }
    .step .badge{
      font-size:11px; padding:2px 8px; border-radius:999px;
      background: rgba(255,255,255,0.10);
      color:#e7eefc;
    }
    .step.done{
      border-color: rgba(120, 255, 160, 0.35);
      background: rgba(80, 255, 140, 0.10);
    }
    .step.done .badge{
      background: rgba(80, 255, 140, 0.20);
      color:#b9ffd2;
    }
    .hintbox{
      margin-top:8px; padding:8px 10px; border-radius:10px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.10);
      font-size:11px; color:#b8c2d9; line-height:1.25;
    }

    /* Toast con acciÃ³n (Deshacer) */
    #err button{
      margin-left:10px;
      background: rgba(255,255,255,0.12);
      border:1px solid rgba(255,255,255,0.20);
      color:#fff;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
    }
    #err button:hover{ background: rgba(255,255,255,0.20); }

</style>
</head>
<body>

  <div id="hud">
    <h3>
      <span><span class="status-dot"></span>CCTV Visor Pro v15 Mobile â€” v15-stable</span>
      <span style="display:flex; gap:6px; align-items:center;">
      <button id="btnHudToggle" class="iconbtn" title="Mostrar/Ocultar panel">â˜°</button>
      <button id="btnModeToggle" class="iconbtn" title="Modo FÃ¡cil / Pro">ğŸ›ï¸</button>
      <span id="scalePill" class="pill">Sin Calibrar</span>
    </span>
    </h3>


    <div class="section easy-only" id="easyWizard">
      <label class="section-title">ğŸ‘£ MODO FÃCIL â€” PASOS</label>

      <div class="row">
        <button id="btnModeEasy" class="active">ğŸ”° FÃ¡cil</button>
        <button id="btnModePro">ğŸ› ï¸ Pro</button>
      </div>

      <div class="steps">
        <div class="step" id="stScale">1) ğŸ“ Calibrar <span class="badge" id="bdScale">Pendiente</span></div>
        <div class="step" id="stPer">2) ğŸš§ PerÃ­metro <span class="badge" id="bdPer">Pendiente</span></div>
        <div class="step" id="stCams">3) ğŸ“¹ CÃ¡maras <span class="badge" id="bdCams">0</span></div>
      </div>

      <div class="row" style="margin-top:8px;">
        <button id="btnQuickScale" class="success">ğŸ“ Calibrar</button>
        <button id="btnQuickPer" class="success">ğŸš§ PerÃ­metro</button>
      </div>
      <label style="margin-top:10px;">ğŸ·ï¸ Nombre del sitio</label>
      <input id="txtSiteEasy" type="text" placeholder="Ej. Base Lerdo / Patio 1" />

      <div class="row">
        <button id="btnQuickNext" class="success" style="flex:2">ğŸ“¹ Colocar siguiente (Plan)</button>
        <button id="btnQuickShot" class="success">ğŸ“¸ Capturar</button>
      </div>
      <div class="row">
        <button id="btnQuickShare">ğŸ’¾ Compartir</button>
        <button id="btnQuickHelp">â“ Ayuda</button>
      </div>

      <div class="hintbox" id="easyHint">
        Tip rÃ¡pido: usa <b>Calibrar</b> (2 clicks) â†’ dibuja <b>PerÃ­metro</b> â†’ coloca cÃ¡maras con <b>Siguiente</b>.
      </div>
      <div class="small" id="easyPlanLine"></div>

      <label style="margin-top:10px;">ğŸ“¹ Preset de cÃ¡mara (para nuevas cÃ¡maras)</label>
      <select id="camPresetEasy">
        <option value="domo_interior">Domo interior (3m / 15m / 20Â°)</option>
        <option value="bala_exterior" selected>Bala exterior (4m / 30m / 25Â°)</option>
        <option value="lpr">LPR / Placas (3m / 12m / 10Â°)</option>
        <option value="ptz">PTZ (6m / 80m / 15Â°)</option>
      </select>
      <div class="small">Esto ajusta altura/Ã¡ngulo/distancia automÃ¡ticamente. Para ajustes finos, cambia a ğŸ› ï¸ Pro.</div>
    </div>

    <div class="section easy-only" id="easyShare" style="display:none;">
      <label class="section-title">ğŸ’¾ COMPARTIR</label>
      <div class="row">
        <button id="btnCopyJson" class="success">ğŸ“‹ Copiar JSON</button>
        <button id="btnDownloadJson" class="success">â¬‡ï¸ Descargar JSON</button>
      </div>
      <div class="row">
        <button id="btnImportFile">ğŸ“‚ Importar archivo</button>
        <button id="btnCloseShare">âœ–ï¸ Cerrar</button>
      </div>
      <input type="file" id="fileImport" accept=".json,application/json" style="display:none;">
      <div class="small">Comparte el archivo <b>.json</b> con tu equipo o sÃºbelo al repo. TambiÃ©n puedes importar uno aquÃ­.</div>
    </div>

    <div class="section pro-only">
      <label class="section-title">HERRAMIENTAS GLOBALES</label>
      <div class="row">
        <button id="btnReset">ğŸ‘ï¸ Reset Vista</button>
        <button id="btnScale">ğŸ“ Calibrar (Metros)</button>
        <button id="btnToggleBld">ğŸ¢ Edificios</button>
        <button id="btnLockView">ğŸ”’ Bloquear Fondo</button>
        <button id="btnLockAll">ğŸ”’ Bloquear TODO</button>
        <button id="btnMeasure">ğŸ“ Distancia</button>
        <button id="btnArea">ğŸ”³ Ãrea</button>
        <button id="btnCloseArea" class="success" disabled>âœ… Cerrar Ãrea</button>
        <button id="btnClearMeasure" class="danger">ğŸ§½ Limpiar</button>
      </div>
      <div id="measureInfo" class="small"></div>
    </div>

    <div class="section pro-only">
      <label class="section-title">VISUAL</label>
      <div class="row">
        <button id="btnFog">ğŸŒ«ï¸ Niebla</button>
        <button id="btnShadows">â˜€ï¸ Sombras</button>
        <button id="btnEdges">ğŸ§Š Bordes</button>
        <button id="btnMobile">ğŸ“± Modo mÃ³vil</button>
      </div>
      <label>Plano base</label>
      <select id="groundSelect">
        <option value="default">Base estÃ¡ndar (ground.jpg)</option>
        <option value="concrete">Concreto (suelo)</option>
        <option value="dirt">Tierra (suelo)</option>
        <option value="none">Sin textura (gris)</option>
      </select>
      <div class="row">
        <button id="btnGroundFit" class="success">ğŸ¯ Ajustar al perÃ­metro</button>
        <button id="btnGrid">ğŸ§­ Grid</button>
      </div>
      <div>
        <label>Brillo / ExposiciÃ³n: <span id="valExp" class="val-disp">1.45</span>x</label>
        <input type="range" id="rngExp" min="0.8" max="2.6" step="0.05" value="1.45">
      </div>
      <div>
        <label>Relieve (3D): <span id="valBump" class="val-disp">0.25</span></label>
        <input type="range" id="rngBump" min="0" max="0.8" step="0.05" value="0.25">
      </div>
      <div class="small">Tip: cambia el plano base para que el sitio sea mÃ¡s legible y ajusta el grid para medir mejor.</div>
    </div>

    <!-- (El resto del archivo continÃºa exactamente como en tu proyecto) -->
  </div>

  <script type="module" src="./src/main.ts"></script>
</body>
</html>
